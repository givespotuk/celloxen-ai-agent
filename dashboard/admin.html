<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Celloxen Admin Dashboard - Healthcare Management System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f0f2f5;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 260px;
            height: 100vh;
            background: linear-gradient(135deg, #5e72e4 0%, #825ee4 100%);
            color: white;
            overflow-y: auto;
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .sidebar-header {
            padding: 30px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .sidebar-header h2 {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .sidebar-header p {
            font-size: 0.85rem;
            opacity: 0.9;
        }

        .sidebar-menu {
            padding: 20px 0;
        }

        .menu-item {
            padding: 15px 25px;
            display: flex;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            color: white;
        }

        .menu-item:hover, .menu-item.active {
            background: rgba(255, 255, 255, 0.1);
            border-left: 4px solid white;
        }

        .menu-item i {
            margin-right: 12px;
            font-size: 1.1rem;
            width: 20px;
            text-align: center;
        }

        /* Main Content */
        .main-content {
            margin-left: 260px;
            padding: 0;
            min-height: 100vh;
        }

        /* Top Navigation */
        .top-nav {
            background: white;
            padding: 20px 30px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .breadcrumb {
            font-size: 1.4rem;
            color: #2d3436;
            font-weight: 600;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .user-info .user-name {
            color: #495057;
            font-weight: 500;
        }

        .logout-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .logout-btn:hover {
            background: #c82333;
            transform: translateY(-1px);
        }

        /* Dashboard Content */
        .dashboard-content {
            padding: 30px;
        }

        /* Section visibility */
        .dashboard-section {
            display: block;
        }
        
        .dashboard-section.hidden {
            display: none;
        }

        /* Stats Cards */
        .stats-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.12);
        }

        .stat-card .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin-bottom: 15px;
        }

        .stat-card.primary .stat-icon {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .stat-card.success .stat-icon {
            background: linear-gradient(135deg, #48dbfb 0%, #0abde3 100%);
            color: white;
        }

        .stat-card.warning .stat-icon {
            background: linear-gradient(135deg, #feca57 0%, #ff9ff3 100%);
            color: white;
        }

        .stat-card.danger .stat-icon {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
            color: white;
        }

        .stat-card .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: #2d3436;
            margin-bottom: 5px;
        }

        .stat-card .stat-label {
            color: #6c757d;
            font-size: 0.95rem;
        }

        /* Mini Stats */
        .mini-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .mini-stat-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.08);
        }
        
        .mini-stat-card .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #2d3436;
        }
        
        .mini-stat-card .stat-label {
            color: #6c757d;
            font-size: 0.85rem;
            margin-top: 5px;
        }

        /* Table Section */
        .table-section {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            margin-bottom: 30px;
        }

        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .table-header h3 {
            color: #2d3436;
            font-size: 1.3rem;
            font-weight: 600;
        }

        .btn-add {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .btn-add:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .search-bar {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .search-bar input {
            flex: 1;
            padding: 10px 15px;
            border: 2px solid #e1e5eb;
            border-radius: 8px;
            font-size: 0.95rem;
        }

        .search-bar input:focus {
            outline: none;
            border-color: #667eea;
        }

        .search-bar button {
            padding: 10px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
        }

        /* Filter Bar */
        .filter-bar {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .filter-bar select,
        .filter-bar input {
            padding: 8px 12px;
            border: 2px solid #e1e5eb;
            border-radius: 8px;
            font-size: 0.95rem;
        }
        
        .filter-bar button {
            padding: 8px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
        }

        /* Reports Styles */
        .report-filters {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            flex-wrap: wrap;
        }

        .report-filters select,
        .report-filters input {
            padding: 10px 15px;
            border: 2px solid #e1e5eb;
            border-radius: 8px;
            font-size: 0.95rem;
        }

        .report-filters button {
            padding: 10px 25px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
        }

        .report-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .report-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .report-card h4 {
            color: #2d3436;
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f2f5;
        }

        .chart-container {
            width: 100%;
            height: 300px;
            position: relative;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .summary-item {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .summary-item .value {
            font-size: 2rem;
            font-weight: 700;
            color: #5e72e4;
            display: block;
            margin-bottom: 5px;
        }

        .summary-item .label {
            font-size: 0.85rem;
            color: #6c757d;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .performance-table {
            width: 100%;
            margin-top: 15px;
        }

        .performance-table th {
            background: #f8f9fa;
            padding: 10px;
            text-align: left;
            font-size: 0.9rem;
            color: #495057;
        }

        .performance-table td {
            padding: 10px;
            border-bottom: 1px solid #e9ecef;
        }

        .usage-bar {
            width: 100%;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .usage-fill {
            height: 100%;
            background: linear-gradient(135deg, #06ffa5 0%, #00b4d8 100%);
            transition: width 0.3s ease;
        }

        .usage-fill.warning {
            background: linear-gradient(135deg, #feca57 0%, #ff9ff3 100%);
        }

        .usage-fill.danger {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
        }

        .export-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-bottom: 20px;
        }

        .export-buttons button {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .btn-export-csv {
            background: #28a745;
            color: white;
        }

        .btn-export-pdf {
            background: #dc3545;
            color: white;
        }

        .btn-print {
            background: #6c757d;
            color: white;
        }

        .symptom-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .symptom-item {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            border-bottom: 1px solid #e9ecef;
        }

        .symptom-item:hover {
            background: #f8f9fa;
        }

        .trend-table {
            width: 100%;
            margin-top: 15px;
        }

        .trend-table th {
            background: #f8f9fa;
            padding: 10px;
            text-align: left;
            font-size: 0.9rem;
            color: #495057;
        }

        .trend-table td {
            padding: 10px;
            border-bottom: 1px solid #e9ecef;
        }

        /* Table */
        .data-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
        }

        .data-table thead {
            background: #f8f9fa;
        }

        .data-table th {
            padding: 12px 15px;
            text-align: left;
            font-weight: 600;
            color: #495057;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 2px solid #dee2e6;
        }

        .data-table td {
            padding: 15px;
            border-bottom: 1px solid #e9ecef;
            color: #495057;
        }

        .data-table tbody tr:hover {
            background: #f8f9fa;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .status-badge.active {
            background: #d4edda;
            color: #155724;
        }

        .status-badge.trial {
            background: #fff3cd;
            color: #856404;
        }

        .status-badge.inactive {
            background: #f8d7da;
            color: #721c24;
        }

        .status-badge.completed {
            background: #d4edda;
            color: #155724;
        }

        .status-badge.in_progress {
            background: #fff3cd;
            color: #856404;
        }

        .action-buttons {
            display: flex;
            gap: 8px;
        }

        .btn-action {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .btn-view {
            background: #17a2b8;
            color: white;
        }

        .btn-edit {
            background: #ffc107;
            color: #212529;
        }

        .btn-delete {
            background: #dc3545;
            color: white;
        }

        .btn-action:hover {
            transform: translateY(-1px);
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.15);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            align-items: center;
            justify-content: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            margin-bottom: 20px;
        }

        .modal-header h3 {
            color: #2d3436;
            font-size: 1.5rem;
            font-weight: 600;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            color: #495057;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px 15px;
            border: 2px solid #e1e5eb;
            border-radius: 8px;
            font-size: 0.95rem;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .modal-footer {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 25px;
        }

        .modal-footer button {
            padding: 10px 20px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .btn-cancel {
            background: #6c757d;
            color: white;
        }

        .btn-save {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        /* View Modal */
        .view-modal-content {
            background: white;
            border-radius: 12px;
            padding: 30px;
            max-width: 700px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .clinic-details {
            margin-bottom: 20px;
        }

        .detail-row {
            display: grid;
            grid-template-columns: 150px 1fr;
            margin-bottom: 10px;
            padding: 8px 0;
            border-bottom: 1px solid #e9ecef;
        }

        .detail-label {
            font-weight: 600;
            color: #495057;
        }

        .detail-value {
            color: #212529;
        }

        /* Loading Spinner */
        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Alert Messages */
        .alert {
            padding: 12px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        .alert.show {
            display: block;
        }

        .alert.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .alert.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                width: 0;
                overflow: hidden;
            }

            .sidebar.active {
                width: 260px;
            }

            .main-content {
                margin-left: 0;
            }

            .stats-row {
                grid-template-columns: 1fr;
            }

            .report-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-header">
            <h2>CELLOXEN</h2>
            <p>Admin Dashboard</p>
        </div>
        <div class="sidebar-menu">
            <a href="#" class="menu-item active" data-section="overview">
                <i>📊</i> Overview
            </a>
            <a href="#" class="menu-item" data-section="clinics">
                <i>🏥</i> Clinics
            </a>
            <a href="#" class="menu-item" data-section="assessments">
                <i>📋</i> Assessments
            </a>
            <a href="#" class="menu-item" data-section="reports">
                <i>📈</i> Reports
            </a>
            <a href="#" class="menu-item" data-section="settings">
                <i>⚙️</i> Settings
            </a>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Top Navigation -->
        <div class="top-nav">
            <h1 class="breadcrumb">Dashboard Overview</h1>
            <div class="user-info">
                <span class="user-name" id="userName">Administrator</span>
                <button class="logout-btn" onclick="logout()">Logout</button>
            </div>
        </div>

        <!-- Dashboard Content -->
        <div class="dashboard-content">
            <div class="alert success" id="successAlert"></div>
            <div class="alert error" id="errorAlert"></div>
            <div class="alert info" id="infoAlert"></div>

            <!-- Overview Section -->
            <div id="overview-section" class="dashboard-section">
                <!-- Stats Cards -->
                <div class="stats-row">
                    <div class="stat-card primary">
                        <div class="stat-icon">🏥</div>
                        <div class="stat-value" id="totalClinics">0</div>
                        <div class="stat-label">Total Clinics</div>
                    </div>
                    <div class="stat-card success">
                        <div class="stat-icon">✅</div>
                        <div class="stat-value" id="activeClinics">0</div>
                        <div class="stat-label">Active Clinics</div>
                    </div>
                    <div class="stat-card warning">
                        <div class="stat-icon">📋</div>
                        <div class="stat-value" id="totalAssessments">0</div>
                        <div class="stat-label">Total Assessments</div>
                    </div>
                    <div class="stat-card danger">
                        <div class="stat-icon">💰</div>
                        <div class="stat-value" id="monthlyRevenue">£0</div>
                        <div class="stat-label">Monthly Revenue</div>
                    </div>
                </div>
            </div>

            <!-- Clinics Section -->
            <div id="clinics-section" class="dashboard-section hidden">
                <div class="table-section">
                    <div class="table-header">
                        <h3>Clinic Management</h3>
                        <button class="btn-add" onclick="openAddClinicModal()">+ Add New Clinic</button>
                    </div>
                    
                    <div class="search-bar">
                        <input type="text" id="searchInput" placeholder="Search clinics...">
                        <button onclick="searchClinics()">Search</button>
                    </div>

                    <div class="loading" id="loadingDiv">
                        <div class="spinner"></div>
                        <p>Loading clinics...</p>
                    </div>

                    <table class="data-table" id="clinicsTable">
                        <thead>
                            <tr>
                                <th>Clinic Name</th>
                                <th>Email</th>
                                <th>Status</th>
                                <th>Assessments</th>
                                <th>Usage</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="clinicsTableBody">
                            <!-- Data will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Assessments Section -->
            <div id="assessments-section" class="dashboard-section hidden">
                <div class="table-section">
                    <div class="table-header">
                        <h3>All Assessments</h3>
                    </div>

                    <!-- Mini Stats -->
                    <div class="mini-stats">
                        <div class="mini-stat-card">
                            <div class="stat-value" id="assessmentTotal">0</div>
                            <div class="stat-label">Total (30 days)</div>
                        </div>
                        <div class="mini-stat-card">
                            <div class="stat-value" id="assessmentCompleted">0</div>
                            <div class="stat-label">Completed</div>
                        </div>
                        <div class="mini-stat-card">
                            <div class="stat-value" id="assessmentInProgress">0</div>
                            <div class="stat-label">In Progress</div>
                        </div>
                        <div class="mini-stat-card">
                            <div class="stat-value" id="assessmentClinics">0</div>
                            <div class="stat-label">Active Clinics</div>
                        </div>
                    </div>

                    <!-- Filters -->
                    <div class="filter-bar">
                        <select id="filterClinic">
                            <option value="">All Clinics</option>
                        </select>
                        <select id="filterStatus">
                            <option value="">All Status</option>
                            <option value="completed">Completed</option>
                            <option value="in_progress">In Progress</option>
                        </select>
                        <input type="date" id="filterDateFrom" placeholder="From Date">
                        <input type="date" id="filterDateTo" placeholder="To Date">
                        <button onclick="filterAssessments()">Apply Filters</button>
                        <button onclick="resetFilters()">Reset</button>
                    </div>

                    <div class="loading" id="assessmentLoadingDiv">
                        <div class="spinner"></div>
                        <p>Loading assessments...</p>
                    </div>

                    <table class="data-table" id="assessmentsTable">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Session ID</th>
                                <th>Clinic</th>
                                <th>Patient</th>
                                <th>Practitioner</th>
                                <th>Status</th>
                                <th>Therapy</th>
                            </tr>
                        </thead>
                        <tbody id="assessmentsTableBody">
                            <!-- Data will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Reports Section -->
            <div id="reports-section" class="dashboard-section hidden">
                <div class="table-section">
                    <div class="table-header">
                        <h3>Analytics & Reports</h3>
                        <div class="export-buttons">
                            <button class="btn-export-csv" onclick="exportCSV()">📊 Export CSV</button>
                            <button class="btn-export-pdf" onclick="exportPDF()">📄 Export PDF</button>
                            <button class="btn-print" onclick="printReports()">🖨️ Print</button>
                        </div>
                    </div>

                    <!-- Filters -->
                    <div class="report-filters">
                        <select id="reportType">
                            <option value="all">All Reports</option>
                            <option value="therapy">Therapy Analysis</option>
                            <option value="clinic">Clinic Performance</option>
                            <option value="trends">Monthly Trends</option>
                        </select>
                        <input type="date" id="reportDateFrom" placeholder="From Date">
                        <input type="date" id="reportDateTo" placeholder="To Date">
                        <select id="reportClinic">
                            <option value="">All Clinics</option>
                        </select>
                        <button onclick="generateReports()">Generate Reports</button>
                        <button onclick="resetReportFilters()">Reset</button>
                    </div>

                    <!-- Summary Cards -->
                    <div class="summary-grid" id="reportSummary">
                        <div class="summary-item">
                            <span class="value" id="totalAssessmentsReport">0</span>
                            <span class="label">Total Assessments</span>
                        </div>
                        <div class="summary-item">
                            <span class="value" id="totalClinicsReport">0</span>
                            <span class="label">Active Clinics</span>
                        </div>
                        <div class="summary-item">
                            <span class="value" id="totalPatientsReport">0</span>
                            <span class="label">Total Patients</span>
                        </div>
                        <div class="summary-item">
                            <span class="value" id="completionRateReport">0%</span>
                            <span class="label">Completion Rate</span>
                        </div>
                        <div class="summary-item">
                            <span class="value" id="avgSeverityReport">0</span>
                            <span class="label">Avg Severity</span>
                        </div>
                    </div>

                    <!-- Report Cards Grid -->
                    <div class="report-grid">
                        <!-- Therapy Distribution -->
                        <div class="report-card">
                            <h4>Therapy Distribution</h4>
                            <div id="therapyChart" class="chart-container">
                                <table class="performance-table" id="therapyTable">
                                    <thead>
                                        <tr>
                                            <th>Therapy</th>
                                            <th>Code</th>
                                            <th>Count</th>
                                            <th>Percentage</th>
                                        </tr>
                                    </thead>
                                    <tbody id="therapyTableBody">
                                        <!-- Data will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Monthly Trends -->
                        <div class="report-card">
                            <h4>Monthly Trends (12 Months)</h4>
                            <div id="trendsChart" class="chart-container">
                                <table class="trend-table" id="trendsTable">
                                    <thead>
                                        <tr>
                                            <th>Month</th>
                                            <th>Total</th>
                                            <th>Completed</th>
                                            <th>Clinics</th>
                                        </tr>
                                    </thead>
                                    <tbody id="trendsTableBody">
                                        <!-- Data will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Clinic Performance -->
                        <div class="report-card">
                            <h4>Clinic Performance</h4>
                            <div id="clinicPerfChart" class="chart-container">
                                <table class="performance-table" id="clinicPerfTable">
                                    <thead>
                                        <tr>
                                            <th>Clinic</th>
                                            <th>Assessments</th>
                                            <th>Usage</th>
                                        </tr>
                                    </thead>
                                    <tbody id="clinicPerfTableBody">
                                        <!-- Data will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Top Symptoms -->
                        <div class="report-card">
                            <h4>Top Reported Symptoms</h4>
                            <div class="symptom-list" id="symptomsList">
                                <!-- Symptoms will be loaded here -->
                            </div>
                        </div>
                    </div>

                    <div class="loading" id="reportLoadingDiv">
                        <div class="spinner"></div>
                        <p>Generating reports...</p>
                    </div>
                </div>
            </div>

            <!-- Settings Section -->
            <div id="settings-section" class="dashboard-section hidden">
                <div class="table-section">
                    <h3>System Settings</h3>
                    <p>System configuration options coming soon...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Add/Edit Clinic Modal -->
    <div class="modal" id="clinicModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Add New Clinic</h3>
            </div>
            <form id="clinicForm">
                <input type="hidden" id="clinicId">
                <div class="form-group">
                    <label for="clinicName">Clinic Name</label>
                    <input type="text" id="clinicName" required>
                </div>
                <div class="form-group">
                    <label for="clinicEmail">Email</label>
                    <input type="email" id="clinicEmail" required>
                </div>
                <div class="form-group">
                    <label for="ownerName">Owner Name</label>
                    <input type="text" id="ownerName" required>
                </div>
                <div class="form-group">
                    <label for="clinicPhone">Phone</label>
                    <input type="tel" id="clinicPhone">
                </div>
                <div class="form-group">
                    <label for="clinicAddress">Address</label>
                    <textarea id="clinicAddress" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label for="subscriptionStatus">Status</label>
                    <select id="subscriptionStatus">
                        <option value="trial">Trial</option>
                        <option value="active">Active</option>
                        <option value="inactive">Inactive</option>
                    </select>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn-cancel" onclick="closeModal()">Cancel</button>
                    <button type="submit" class="btn-save">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- View Clinic Modal -->
    <div class="modal" id="viewModal">
        <div class="view-modal-content">
            <div class="modal-header">
                <h3>Clinic Details</h3>
            </div>
            <div class="clinic-details" id="clinicDetails">
                <!-- Details will be loaded here -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-cancel" onclick="closeViewModal()">Close</button>
            </div>
        </div>
    </div>

    <script>
        // Check authentication
        const token = localStorage.getItem('token');
        const user = JSON.parse(localStorage.getItem('user') || '{}');

        if (!token || user.role !== 'super_admin') {
            window.location.href = '/login.html';
        }

        // Set user name
        document.getElementById('userName').textContent = user.displayName || 'Administrator';

        let allClinics = [];
        let currentEditingClinic = null;
        let reportData = null;

        // Load initial data
        loadDashboard();

        // Section management
        function showSection(sectionName) {
            // Hide all sections
            document.querySelectorAll('.dashboard-section').forEach(section => {
                section.classList.add('hidden');
            });
            
            // Show selected section
            const section = document.getElementById(`${sectionName}-section`);
            if (section) {
                section.classList.remove('hidden');
            }
            
            // Load section-specific data
            if (sectionName === 'overview' || sectionName === 'clinics') {
                loadDashboard();
            } else if (sectionName === 'assessments') {
                loadAssessments();
            } else if (sectionName === 'reports') {
                generateReports();
            }
        }

        async function loadDashboard() {
            // Show loading
            document.getElementById('loadingDiv').classList.add('show');
            
            try {
                const response = await fetch('/api/getClinicStats', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + token
                    },
                    body: JSON.stringify({
                        role: 'super_admin'
                    })
                });

                const stats = await response.json();
                
                // Update stats cards
                document.getElementById('totalClinics').textContent = stats.totalClinics || '0';
                document.getElementById('activeClinics').textContent = stats.activeClinics || '0';
                document.getElementById('totalAssessments').textContent = stats.totalAssessments || '0';
                
                // Calculate monthly revenue (example: £30 per active clinic)
                const monthlyRevenue = (stats.activeClinics || 0) * 30;
                document.getElementById('monthlyRevenue').textContent = `£${monthlyRevenue}`;
                
                // Store and display clinics
                allClinics = stats.clinics || [];
                displayClinics(allClinics);
                
            } catch (error) {
                console.error('Error loading dashboard:', error);
                showAlert('Error loading dashboard data', 'error');
            } finally {
                document.getElementById('loadingDiv').classList.remove('show');
            }
        }

        function displayClinics(clinics) {
            const tbody = document.getElementById('clinicsTableBody');
            tbody.innerHTML = '';
            
            clinics.forEach(clinic => {
                const row = document.createElement('tr');
                const status = clinic.is_active ? 'active' : 'inactive';
                const statusText = clinic.subscription_status || status;
                
                row.innerHTML = `
                    <td>${clinic.clinic_name || clinic.owner_name || 'N/A'}</td>
                    <td>${clinic.email}</td>
                    <td><span class="status-badge ${status}">${statusText}</span></td>
                    <td>${clinic.assessment_count || 0}</td>
                    <td>${clinic.usage_count || 0}/${clinic.usage_limit || 100}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn-action btn-view" onclick="viewClinic(${clinic.id})">View</button>
                            <button class="btn-action btn-edit" onclick="editClinic(${clinic.id})">Edit</button>
                            <button class="btn-action btn-delete" onclick="deleteClinic(${clinic.id})">Delete</button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Load assessments
        async function loadAssessments() {
            const loadingDiv = document.getElementById('assessmentLoadingDiv');
            if (loadingDiv) loadingDiv.classList.add('show');
            
            try {
                const response = await fetch('/api/getAllAssessments', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + token
                    },
                    body: JSON.stringify({})
                });

                const data = await response.json();
                
                if (data.success) {
                    // Update mini stats
                    document.getElementById('assessmentTotal').textContent = data.stats.total;
                    document.getElementById('assessmentCompleted').textContent = data.stats.completed;
                    document.getElementById('assessmentInProgress').textContent = data.stats.inProgress;
                    document.getElementById('assessmentClinics').textContent = data.stats.uniqueClinics;
                    
                    // Populate clinic filter
                    populateClinicFilter(data.assessments);
                    
                    // Display assessments
                    displayAssessments(data.assessments);
                } else {
                    // If API doesn't exist yet, show placeholder data
                    showAlert('Assessments API not configured yet', 'error');
                }
            } catch (error) {
                console.error('Error loading assessments:', error);
                // Show placeholder message
                document.getElementById('assessmentsTableBody').innerHTML = 
                    '<tr><td colspan="7" style="text-align: center;">Assessment tracking will be available once clinics start using the system</td></tr>';
            } finally {
                if (loadingDiv) loadingDiv.classList.remove('show');
            }
        }

        function populateClinicFilter(assessments) {
            const clinics = [...new Map(assessments.map(a => [a.clinic_id, a.clinic_name])).entries()];
            const select = document.getElementById('filterClinic');
            select.innerHTML = '<option value="">All Clinics</option>';
            
            clinics.forEach(([id, name]) => {
                if (id && name) {
                    const option = document.createElement('option');
                    option.value = id;
                    option.textContent = name;
                    select.appendChild(option);
                }
            });
        }

        function displayAssessments(assessments) {
            const tbody = document.getElementById('assessmentsTableBody');
            tbody.innerHTML = '';
            
            if (!assessments || assessments.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center;">No assessments found</td></tr>';
                return;
            }
            
            assessments.forEach(assessment => {
                const row = document.createElement('tr');
                const date = new Date(assessment.started_at).toLocaleDateString('en-GB');
                const status = assessment.status || 'unknown';
                
                row.innerHTML = `
                    <td>${date}</td>
                    <td>${assessment.session_id.substring(0, 8)}...</td>
                    <td>${assessment.clinic_name || 'Direct'}</td>
                    <td>${assessment.patient_name || 'N/A'}</td>
                    <td>${assessment.practitioner_name || 'N/A'}</td>
                    <td><span class="status-badge ${status.replace('_', '-')}">${status.replace('_', ' ')}</span></td>
                    <td>${assessment.recommended_therapy_name || 'Pending'}</td>
                `;
                tbody.appendChild(row);
            });
        }

        async function filterAssessments() {
            const clinicId = document.getElementById('filterClinic').value;
            const status = document.getElementById('filterStatus').value;
            const dateFrom = document.getElementById('filterDateFrom').value;
            const dateTo = document.getElementById('filterDateTo').value;
            
            const loadingDiv = document.getElementById('assessmentLoadingDiv');
            if (loadingDiv) loadingDiv.classList.add('show');
            
            try {
                const response = await fetch('/api/getAllAssessments', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + token
                    },
                    body: JSON.stringify({
                        clinicId,
                        status,
                        dateFrom,
                        dateTo
                    })
                });

                const data = await response.json();
                
                if (data.success) {
                    displayAssessments(data.assessments);
                }
            } catch (error) {
                showAlert('Error filtering assessments', 'error');
            } finally {
                if (loadingDiv) loadingDiv.classList.remove('show');
            }
        }

        function resetFilters() {
            document.getElementById('filterClinic').value = '';
            document.getElementById('filterStatus').value = '';
            document.getElementById('filterDateFrom').value = '';
            document.getElementById('filterDateTo').value = '';
            loadAssessments();
        }

        // Reports functionality
        async function generateReports() {
            const loadingDiv = document.getElementById('reportLoadingDiv');
            if (loadingDiv) loadingDiv.classList.add('show');
            
            const reportType = document.getElementById('reportType').value;
            const dateFrom = document.getElementById('reportDateFrom').value;
            const dateTo = document.getElementById('reportDateTo').value;
            const clinicId = document.getElementById('reportClinic').value;
            
            try {
                const response = await fetch('/api/getReports', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + token
                    },
                    body: JSON.stringify({
                        reportType,
                        dateFrom,
                        dateTo,
                        clinicId
                    })
                });

                const data = await response.json();
                
                if (data.success) {
                    reportData = data;
                    displayReports(data);
                } else {
                    // If API doesn't exist yet, show sample data
                    displaySampleReports();
                }
            } catch (error) {
                console.error('Error generating reports:', error);
                displaySampleReports();
            } finally {
                if (loadingDiv) loadingDiv.classList.remove('show');
            }
        }

        function displayReports(data) {
            // Update summary
            document.getElementById('totalAssessmentsReport').textContent = 
                data.summary?.total_assessments || '0';
            document.getElementById('totalClinicsReport').textContent = 
                data.summary?.total_clinics || '0';
            document.getElementById('totalPatientsReport').textContent = 
                data.summary?.total_patients || '0';
            document.getElementById('completionRateReport').textContent = 
                Math.round(data.summary?.completion_rate || 0) + '%';
            document.getElementById('avgSeverityReport').textContent = 
                (data.summary?.avg_severity || 0).toFixed(1);
            
            // Display therapy distribution
            displayTherapyDistribution(data.therapyDistribution);
            
            // Display monthly trends
            displayMonthlyTrends(data.monthlyTrends);
            
            // Display clinic performance
            displayClinicPerformance(data.clinicPerformance);
            
            // Display top symptoms
            displayTopSymptoms(data.topSymptoms);
        }

        function displayTherapyDistribution(therapies) {
            const tbody = document.getElementById('therapyTableBody');
            tbody.innerHTML = '';
            
            if (!therapies || therapies.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" style="text-align: center;">No therapy data available</td></tr>';
                return;
            }
            
            const total = therapies.reduce((sum, t) => sum + parseInt(t.count), 0);
            
            therapies.forEach(therapy => {
                const percentage = ((therapy.count / total) * 100).toFixed(1);
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${therapy.therapy || 'Unknown'}</td>
                    <td>${therapy.code || 'N/A'}</td>
                    <td>${therapy.count}</td>
                    <td>${percentage}%</td>
                `;
                tbody.appendChild(row);
            });
        }

        function displayMonthlyTrends(trends) {
            const tbody = document.getElementById('trendsTableBody');
            tbody.innerHTML = '';
            
            if (!trends || trends.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" style="text-align: center;">No trend data available</td></tr>';
                return;
            }
            
            trends.forEach(trend => {
                const month = new Date(trend.month).toLocaleDateString('en-GB', { 
                    month: 'short', 
                    year: 'numeric' 
                });
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${month}</td>
                    <td>${trend.total}</td>
                    <td>${trend.completed}</td>
                    <td>${trend.active_clinics}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function displayClinicPerformance(clinics) {
            const tbody = document.getElementById('clinicPerfTableBody');
            tbody.innerHTML = '';
            
            if (!clinics || clinics.length === 0) {
                tbody.innerHTML = '<tr><td colspan="3" style="text-align: center;">No clinic performance data</td></tr>';
                return;
            }
            
            clinics.forEach(clinic => {
                const usagePercent = parseFloat(clinic.usage_percentage || 0);
                const usageClass = usagePercent >= 90 ? 'danger' : 
                                  usagePercent >= 70 ? 'warning' : '';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${clinic.clinic_name}</td>
                    <td>${clinic.total_assessments}</td>
                    <td>
                        <div class="usage-bar">
                            <div class="usage-fill ${usageClass}" style="width: ${usagePercent}%"></div>
                        </div>
                        <small>${clinic.usage_count}/${clinic.usage_limit} (${usagePercent}%)</small>
                    </td>
                `;
                tbody.appendChild(row);
            });
            
            // Populate clinic filter
            const select = document.getElementById('reportClinic');
            select.innerHTML = '<option value="">All Clinics</option>';
            clinics.forEach(clinic => {
                const option = document.createElement('option');
                option.value = clinic.id;
                option.textContent = clinic.clinic_name;
                select.appendChild(option);
            });
        }

        function displayTopSymptoms(symptoms) {
            const container = document.getElementById('symptomsList');
            container.innerHTML = '';
            
            if (!symptoms || symptoms.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #6c757d;">No symptom data available</p>';
                return;
            }
            
            symptoms.forEach(symptom => {
                const item = document.createElement('div');
                item.className = 'symptom-item';
                item.innerHTML = `
                    <span>${symptom.symptoms.substring(0, 50)}...</span>
                    <span style="font-weight: 600; color: #5e72e4;">${symptom.frequency}</span>
                `;
                container.appendChild(item);
            });
        }

        function displaySampleReports() {
            // Display sample data when API is not available
            const sampleData = {
                summary: {
                    total_assessments: 45,
                    total_clinics: 2,
                    total_patients: 38,
                    completion_rate: 85,
                    avg_severity: 6.2
                },
                therapyDistribution: [
                    { therapy: 'Stress Relief Therapy', code: '102', count: 12 },
                    { therapy: 'Sleep Quality Therapy', code: '104', count: 8 },
                    { therapy: 'Joint Mobility Therapy', code: '403', count: 6 }
                ],
                monthlyTrends: [
                    { month: '2025-01-01', total: 15, completed: 12, active_clinics: 2 },
                    { month: '2024-12-01', total: 18, completed: 15, active_clinics: 2 },
                    { month: '2024-11-01', total: 12, completed: 11, active_clinics: 1 }
                ],
                clinicPerformance: allClinics.map(c => ({
                    clinic_name: c.clinic_name,
                    id: c.id,
                    total_assessments: c.assessment_count || 0,
                    usage_count: c.usage_count || 0,
                    usage_limit: c.usage_limit || 100,
                    usage_percentage: ((c.usage_count || 0) / (c.usage_limit || 100) * 100).toFixed(2)
                })),
                topSymptoms: [
                    { symptoms: 'Chronic fatigue and exhaustion', frequency: 15 },
                    { symptoms: 'Joint pain and stiffness', frequency: 12 },
                    { symptoms: 'Insomnia and sleep disturbances', frequency: 10 }
                ]
            };
            
            displayReports(sampleData);
        }

        function resetReportFilters() {
            document.getElementById('reportType').value = 'all';
            document.getElementById('reportDateFrom').value = '';
            document.getElementById('reportDateTo').value = '';
            document.getElementById('reportClinic').value = '';
            generateReports();
        }

        function exportCSV() {
            if (!reportData) {
                showAlert('Please generate reports first', 'error');
                return;
            }
            
            // Create CSV content
            let csv = 'Celloxen Health Reports\n';
            csv += `Generated: ${new Date().toLocaleDateString('en-GB')}\n\n`;
            
            // Summary
            csv += 'SUMMARY\n';
            csv += 'Metric,Value\n';
            csv += `Total Assessments,${reportData.summary?.total_assessments || 0}\n`;
            csv += `Total Clinics,${reportData.summary?.total_clinics || 0}\n`;
            csv += `Total Patients,${reportData.summary?.total_patients || 0}\n`;
            csv += `Completion Rate,${Math.round(reportData.summary?.completion_rate || 0)}%\n`;
            csv += `Average Severity,${(reportData.summary?.avg_severity || 0).toFixed(1)}\n\n`;
            
            // Therapy Distribution
            csv += 'THERAPY DISTRIBUTION\n';
            csv += 'Therapy,Code,Count\n';
            reportData.therapyDistribution?.forEach(t => {
                csv += `"${t.therapy}",${t.code},${t.count}\n`;
            });
            
            // Download CSV
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `celloxen-reports-${Date.now()}.csv`;
            a.click();
            window.URL.revokeObjectURL(url);
        }

        function exportPDF() {
            showAlert('PDF export functionality coming soon', 'info');
            // Would implement PDF generation using jsPDF library
        }

        function printReports() {
            window.print();
        }

        function openAddClinicModal() {
            document.getElementById('modalTitle').textContent = 'Add New Clinic';
            document.getElementById('clinicId').value = '';
            document.getElementById('clinicForm').reset();
            currentEditingClinic = null;
            document.getElementById('clinicModal').classList.add('show');
        }

        async function editClinic(id) {
            const clinic = allClinics.find(c => c.id === id);
            if (clinic) {
                currentEditingClinic = clinic;
                document.getElementById('modalTitle').textContent = 'Edit Clinic';
                document.getElementById('clinicId').value = clinic.id;
                document.getElementById('clinicName').value = clinic.clinic_name || '';
                document.getElementById('clinicEmail').value = clinic.email || '';
                document.getElementById('ownerName').value = clinic.owner_name || '';
                document.getElementById('clinicPhone').value = clinic.phone || '';
                document.getElementById('clinicAddress').value = clinic.address || '';
                document.getElementById('subscriptionStatus').value = clinic.subscription_status || 'trial';
                document.getElementById('clinicModal').classList.add('show');
            }
        }

        async function viewClinic(id) {
            try {
                const response = await fetch('/api/getClinic', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + token
                    },
                    body: JSON.stringify({ clinicId: id })
                });

                const data = await response.json();
                
                if (data.success) {
                    const clinic = data.clinic;
                    document.getElementById('clinicDetails').innerHTML = `
                        <div class="detail-row">
                            <div class="detail-label">Clinic Name:</div>
                            <div class="detail-value">${clinic.clinic_name || 'N/A'}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">Email:</div>
                            <div class="detail-value">${clinic.email}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">Owner:</div>
                            <div class="detail-value">${clinic.owner_name || 'N/A'}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">Phone:</div>
                            <div class="detail-value">${clinic.phone || 'N/A'}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">Address:</div>
                            <div class="detail-value">${clinic.address || 'N/A'}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">Status:</div>
                            <div class="detail-value">${clinic.subscription_status || 'trial'}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">Total Assessments:</div>
                            <div class="detail-value">${clinic.total_assessments || 0}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">Total Patients:</div>
                            <div class="detail-value">${clinic.total_patients || 0}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">Usage:</div>
                            <div class="detail-value">${clinic.usage_count || 0}/${clinic.usage_limit || 100}</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">Created:</div>
                            <div class="detail-value">${new Date(clinic.created_at).toLocaleDateString('en-GB')}</div>
                        </div>
                    `;
                    document.getElementById('viewModal').classList.add('show');
                } else {
                    showAlert('Failed to load clinic details', 'error');
                }
            } catch (error) {
                showAlert('Error loading clinic details', 'error');
            }
        }

        async function deleteClinic(id) {
            if (confirm('Are you sure you want to delete this clinic? This action cannot be undone.')) {
                try {
                    const response = await fetch('/api/deleteClinic', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': 'Bearer ' + token
                        },
                        body: JSON.stringify({ clinicId: id })
                    });

                    const data = await response.json();
                    
                    if (data.success) {
                        showAlert(data.message, 'success');
                        loadDashboard();
                    } else {
                        showAlert(data.message || 'Failed to delete clinic', 'error');
                    }
                } catch (error) {
                    showAlert('Error deleting clinic', 'error');
                }
            }
        }

        function closeModal() {
            document.getElementById('clinicModal').classList.remove('show');
            document.getElementByI
            function closeModal() {
            document.getElementById('clinicModal').classList.remove('show');
            document.getElementById('clinicForm').reset();
            currentEditingClinic = null;
        }

        function closeViewModal() {
            document.getElementById('viewModal').classList.remove('show');
        }

        function searchClinics() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            
            if (searchTerm) {
                const filtered = allClinics.filter(clinic => 
                    (clinic.clinic_name && clinic.clinic_name.toLowerCase().includes(searchTerm)) ||
                    (clinic.email && clinic.email.toLowerCase().includes(searchTerm)) ||
                    (clinic.owner_name && clinic.owner_name.toLowerCase().includes(searchTerm))
                );
                displayClinics(filtered);
            } else {
                displayClinics(allClinics);
            }
        }

        function showAlert(message, type) {
            const alertId = type === 'success' ? 'successAlert' : 
                           type === 'error' ? 'errorAlert' : 'infoAlert';
            const alert = document.getElementById(alertId);
            alert.textContent = message;
            alert.classList.add('show');
            
            setTimeout(() => {
                alert.classList.remove('show');
            }, 5000);
        }

        function logout() {
            localStorage.removeItem('token');
            localStorage.removeItem('user');
            window.location.href = '/login.html';
        }

        // Handle menu navigation
        document.querySelectorAll('.menu-item').forEach(item => {
            item.addEventListener('click', (e) => {
                e.preventDefault();
                document.querySelectorAll('.menu-item').forEach(i => i.classList.remove('active'));
                item.classList.add('active');
                const section = item.dataset.section;
                
                document.querySelector('.breadcrumb').textContent = 
                    'Dashboard ' + section.charAt(0).toUpperCase() + section.slice(1);
                
                showSection(section);
            });
        });

        // Handle form submission
        document.getElementById('clinicForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const clinicData = {
                clinicName: document.getElementById('clinicName').value,
                email: document.getElementById('clinicEmail').value,
                ownerName: document.getElementById('ownerName').value,
                phone: document.getElementById('clinicPhone').value,
                address: document.getElementById('clinicAddress').value,
                subscriptionStatus: document.getElementById('subscriptionStatus').value
            };

            try {
                let response;
                if (currentEditingClinic) {
                    // Update existing clinic
                    clinicData.clinicId = currentEditingClinic.id;
                    response = await fetch('/api/updateClinic', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': 'Bearer ' + token
                        },
                        body: JSON.stringify(clinicData)
                    });
                } else {
                    // Add new clinic
                    response = await fetch('/api/addClinic', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': 'Bearer ' + token
                        },
                        body: JSON.stringify(clinicData)
                    });
                }

                const data = await response.json();
                
                if (data.success) {
                    showAlert(data.message, 'success');
                    closeModal();
                    loadDashboard();
                } else {
                    showAlert(data.message || 'Operation failed', 'error');
                }
            } catch (error) {
                showAlert('Error saving clinic', 'error');
            }
        });

        // Refresh data every 60 seconds
        setInterval(() => {
            const activeSection = document.querySelector('.menu-item.active').dataset.section;
            if (activeSection === 'overview' || activeSection === 'clinics') {
                loadDashboard();
            } else if (activeSection === 'assessments') {
                loadAssessments();
            } else if (activeSection === 'reports') {
                generateReports();
            }
        }, 60000);
    </script>
</body>
</html>
